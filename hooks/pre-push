#!/bin/zsh
# Pre-push hook to run make bundle

echo "Running make bundle before push..."

# Run make bundle
if ! make bundle; then
    echo "❌ make bundle failed. Push aborted."
    exit 1
fi

# Check if bundle files were modified (ignoring createdAt timestamp changes)
if ! git diff --quiet -I'^    createdAt: ' bundle/; then
    echo "⚠️  Bundle files were updated by make bundle."
    echo "Please review and commit the changes before pushing:"
    echo "  git add bundle/"
    echo "  git commit -m 'Update bundle manifests'"
    echo "  git push"
    exit 1
fi

echo "✅ make bundle completed successfully, no bundle changes detected."
exit 0
